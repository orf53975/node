#!/bin/bash

###########################################################################
# Uploads all created Android artifacts to the Bintray and JCenter
# - https://bintray.com/mysterium/Node
#
# Usage:
#> bin/release_android <VERSION> <BINTRAY_USER_NAME> <BINTRAY_API_TOKEN>

set -e

source bin/helpers/output.sh

VERSION=$1
if [ -z "$VERSION" ]; then
    print_error "Missing version"
    exit 1
fi
sed -i -E "s|<version>.+</version>|<version>$VERSION</version>|g" bin/package/android/mvn.pom

mvn gpg:sign-and-deploy-file -e -X \
    -settings=bin/package/android/mvn.settings \
    -Durl=https://oss.sonatype.org/content/repositories/snapshots \
    -DrepositoryId=ossrh \
    -Dgpg.keyname=D92DF5C1DA3F192F \
    -DpomFile=bin/package/android/mvn.pom \
    -Dfile=build/package/Mysterium.aar
